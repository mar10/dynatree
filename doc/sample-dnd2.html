<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=ISO-8859-1">
    <title>Dynatree - Example</title>
<!-- 
    <script src='../jquery/jquery.js' type='text/javascript'></script>
    <script src='../jquery/jquery.ui.core.js' type='text/javascript'></script>
    <script src='../jquery/jquery.ui.widget.js' type='text/javascript'></script>
    <script src='../jquery/jquery.cookie.js' type='text/javascript'></script>
    <script src='../jquery/jquery.draggable.js' type='text/javascript'></script>
    <script src='../jquery/jquery.droppable.js' type='text/javascript'></script>
 -->
    <!-- Standard jQuery 1.4 and UI 1.8 -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4/jquery.js" type="text/javascript"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.js" type="text/javascript"></script>

    <link href='../src/skin/ui.dynatree.css' rel='stylesheet' type='text/css'>
    <script src='../src/jquery.dynatree.js' type='text/javascript'></script>

    <style type="text/css">
        #draggableSample, #droppableSample {
            height:100px;
            padding:0.5em;
            width:150px;
            border:1px solid #AAAAAA;
        }
        #draggableSample {
            background-color: silver;
            color:#222222;
        }
        #droppableSample {
            background-color: maroon;
            color: white;
        }
        #droppableSample.drophover {
            border: 1px solid green;
        }
    </style>
 
    <!-- Start_Exclude: This block is not part of the sample code -->
    <link href="prettify.css" rel="stylesheet">
    <script src="prettify.js" type='text/javascript'></script>
    <link href='sample.css' rel='stylesheet' type='text/css'>
    <script src='sample.js' type='text/javascript'></script>
    <!-- End_Exclude -->
    
<script type='text/javascript'>
$(function(){
	// --- Initialize first Dynatree -------------------------------------------
    $("#tree").dynatree({
        onActivate: function(dtnode) {
            $("#echoActive").text(dtnode.data.title + "(" + dtnode.data.key + ")");
        },
        onDeactivate: function(dtnode) {
            $("#echoActive").text("-");
        },
        dnd: {
            onDragStart: function(dtnode) {
                /** This function MUST be defined to enable dragging for the tree.
                 *  Return false to cancel dragging of dtnode.
                 */ 
                logMsg("tree.onDragStart(%o)", dtnode);
                if(dtnode.data.isFolder)
                    return false;
                return true;
            },
            onDragStop: function(dtnode) {
                logMsg("tree.onDragStop(%o)", dtnode);
            }
        }
    });
    // --- Initialize second Dynatree ------------------------------------------
    $("#tree2").dynatree({
        idPrefix: "ui-dynatree-t2-",
        onActivate: function(dtnode) {
            $("#echoActive2").text(dtnode.data.title + "(" + dtnode.data.key + ")");
        },
        onDeactivate: function(dtnode) {
            $("#echoActive2").text("-");
        },
        dnd: {
            autoExpandMS: 1000,
            onDragEnter: function(node, sourceNode) {
                /** sourceNode may be null for non-dynatree droppables. 
                 *  Return false to disallow dropping on node. In this case 
                 *  onDragOver and onDragLeave are not called.
                 *  Return 'over', 'before, or 'after' to force a hitMode.
                 *  Any other return value will calc the hitMode from the cursor position.
                 */
                logMsg("tree.onDragEnter(%o, %o)", node, sourceNode);
                if(node.data.isFolder)
                    return false;
//                return "over";
            },
            onDragOver: function(node, sourceNode, hitMode) {
                /** Return false to disallow dropping this node.
                 *
                 */
                logMsg("tree.onDragOver(%o, %o, %o)", node, sourceNode, hitMode);
            },
            onDrop: function(node, sourceNode, hitMode) {
                /** This function MUST be defined to enable dropping of items on the tree. 
                 */
                logMsg("tree.onDrop(%o, %o)", node, sourceNode);
                var copynode;
                if(sourceNode) {
                    copynode = sourceNode.toDict(true, function(dict){
                        dict.title = "Copy of " + dict.title;
                        delete dict.key; // Remove key, so a new one will be created
                    });
                }else{
                    copynode = {title: "This node was dropped here."};
                }
                node.addChild(copynode);
            },
            onDragLeave: function(node, sourceNode) {
                /** Always called if onDragEnter was called. 
                 */
                logMsg("tree.onDragLeave(%o, %o)", node, sourceNode);
            }
        }
    });
    // --- Initialize simple draggable sample ----------------------------------
    $("#draggableSample").draggable({
        revert: true,
        connectToDynatree: true,
        cursorAt: { top: -5, left:-5 },
        helper: "clone"
    });
    // --- Initialize simple droppable sample ----------------------------------
    $("#droppableSample").droppable({
        hoverClass: "drophover",
        addClasses: true,
        over: function(event, ui) {
            logMsg("droppable.over, %o, %o", event, ui);
        },
        drop: function(event, ui) {
            $(this).addClass('ui-state-highlight').find('p').html('Dropped!');
            alert("dropped");
        }
    });
});
</script>
</head>

<body class="example">
    <h1>Example: Standard jQuery drag-and-drop</h1>
    <p class="description">
        This sample uses the standard jQuery draggable and droppable.
    </p>

    <table>
    <thead>
    <tr>
        <th>
        <p>This tree allows dragging.</p>
        </th>
        <th>
        <p>This tree allows dropping.</p>
        </th>
    </tr>
    </thead>
    <tbody>
    <tr valign="top">
        <td>
            <div id="tree">
                <ul style="display:none">
                    <li id="key1" title="Look, a tool tip!">item1 with key and tooltip
                    <li id="key2" class="selected">item2: selected on init
                    <li id="key3" class="folder">Folder with some children
                        <ul>
                            <li id="key3.1">Sub-item 3.1
                            <li id="key3.2">Sub-item 3.2
                        </ul>
        
                    <li id="key4" class="expanded">Document with some children (expanded on init)
                        <ul>
                            <li id="key4.1">Sub-item 4.1
                            <li id="key4.2">Sub-item 4.2
                        </ul>
                </ul>
            </div>
        </td>
        <td>
            <div id="tree2">
                <ul style="display:none">
                    <li id="key1" title="Look, a tool tip!">item1 with key and tooltip
                    <li id="key2" class="selected">item2: selected on init
                    <li id="key3" class="folder">Folder with some children
                        <ul>
                            <li id="key3.1">Sub-item 3.1
                            <li id="key3.2">Sub-item 3.2
                        </ul>
        
                    <li id="key4" class="expanded">Document with some children (expanded on init)
                        <ul>
                            <li id="key4.1">Sub-item 4.1
                            <li id="key4.2">Sub-item 4.2
                        </ul>
                </ul>
            </div>
        </td>
    </tr>
    <tr>
        <td>
            <div>Active node: <span id="echoActive">-</span></div>
        </td>
        <td>
            <div>Active node: <span id="echoActive2">-</span></div>
        </td>
    </tr>
    <tr>
        <td>
		    <div id="draggableSample" class="ui-widget-content">
		        <p>Drag me around</p>
		    </div>
        </td>
        <td>
            <div id="droppableSample" class="ui-widget-content">
                <p>Drop something here</p>
            </div>
        </td>
    </tr>
    </tbody>
    </table>

    <!-- Start_Exclude: This block is not part of the sample code -->
    <hr>
    <p class="sample-links  no_code">
        <a class="hideInsideFS" href="http://dynatree.googlecode.com">jquery.dynatree.js project home</a>
        <a class="hideOutsideFS" href="#">Link to this page</a>
        <a class="hideInsideFS" href="samples.html">Example Browser</a>
        <a href="#" class="codeExample">View source code</a>
    </p>
    <!-- End_Exclude -->
</body>
</html>
